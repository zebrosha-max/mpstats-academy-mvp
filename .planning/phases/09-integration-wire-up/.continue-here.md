---
phase: 09-integration-wire-up
task: 2
total_tasks: 2
status: in_progress
last_updated: 2026-02-26T09:45:31.005Z
---

<current_state>
Phase 09 execution: Task 1 DONE (profile getDashboard refactored), Task 2 IN PROGRESS (seekTo verification).

Task 2 is a human-verify checkpoint: verify that clicking timecodes in AI summary/chat panels seeks Kinescope video. During testing, discovered that **seekTo via postMessage does NOT work** — Kinescope iframe ignores raw postMessage. Need to integrate Kinescope Iframe Player API.

Attempted fix (commit 8ad2d21, reverted in 79dac48): replaced plain iframe with `@kinescope/player-iframe-api-loader` approach (loading `iframe.player.js` script, using `factory.create()` to create Player). The API loaded but the player container rendered empty/collapsed. Likely issue: wrong URL format in `factory.create()` options — used `https://kinescope.io/{videoId}` but might need different format.
</current_state>

<completed_work>

- Task 1: Wire-up profile getDashboard to use getCompletedSessions — DONE (commit 1781815)
  - `packages/api/src/routers/profile.ts` now imports and calls `getCompletedSessions` from diagnostic.ts
  - TypeScript compiles clean
- Deployed to prod (https://academyal.duckdns.org) — working
- Kinescope API research DONE — found `@kinescope/player-iframe-api-loader` GitHub repo, read full types
</completed_work>

<remaining_work>

- Task 2: Fix KinescopePlayer.tsx to use Kinescope Iframe API with correct URL format
  - The reverted commit (8ad2d21) has the full implementation — just needs URL fix
  - Try URL formats: `https://kinescope.io/embed/{videoId}`, just `{videoId}`, or check Kinescope docs
  - After fix: deploy to prod, verify seekTo works by clicking timecodes
  - Then: create SUMMARY.md, update STATE.md, update ROADMAP.md
- Phase 09 verification (gsd-verifier)
- Phase 09 completion (roadmap update)
</remaining_work>

<decisions_made>

- Plain iframe + postMessage does NOT work with Kinescope — confirmed by testing (no messages from iframe)
- Need Kinescope Iframe Player API (`iframe.player.js` loaded as script tag)
- Don't install npm package — load script directly from CDN to avoid dependency issues
- Player types defined locally as interfaces (not using `declare namespace` which caused ESLint errors)
</decisions_made>

<blockers>

- KinescopePlayer `factory.create()` URL format unknown — video container renders empty
- Reverted commit has the code, just needs correct URL parameter
- Possible: URL should be `https://kinescope.io/embed/{videoId}` not `https://kinescope.io/{videoId}`
- Alternative: check if `factory.create()` needs `keepElement: true` option with pre-existing iframe
</blockers>

<context>
Key files:
- `apps/web/src/components/video/KinescopePlayer.tsx` — current: plain iframe (video shows but no seekTo)
- Reverted commit 8ad2d21 — has full Kinescope API implementation, just needs URL fix
- `apps/web/src/components/video/TimecodeLink.tsx` — working, calls onSeek callback
- `apps/web/src/app/(main)/learn/[id]/page.tsx` — wires TimecodeLink → playerRef.seekTo

Kinescope API source: https://github.com/kinescope/player-iframe-api-loader
- `factory.create(element, { url, size })` → returns Player with seekTo(), play()
- Script: `https://player.kinescope.io/latest/iframe.player.js`
- Their React component uses `keepElement: true` in create options

The profile getDashboard refactor (Task 1) was committed and deployed — it's working fine on prod.
</context>

<next_action>
1. `git show 8ad2d21 -- apps/web/src/components/video/KinescopePlayer.tsx` to see the reverted code
2. Try different URL formats in `factory.create()`: `https://kinescope.io/embed/{videoId}` or just videoId
3. Add `keepElement: true` to create options (the official React component uses this)
4. Deploy and test seekTo on prod
5. If works: commit, create SUMMARY.md, run verifier, complete phase 09
</next_action>
