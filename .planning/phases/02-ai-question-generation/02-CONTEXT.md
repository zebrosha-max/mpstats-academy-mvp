# Phase 2: AI Question Generation - Context

**Gathered:** 2026-02-17
**Status:** Ready for planning

<domain>
## Phase Boundary

Генерация диагностических вопросов из реального контента уроков (RAG chunks) через LLM вместо фиксированного набора mock-вопросов. Включает: сервис генерации, валидацию, fallback на mock, rate limiting. Не включает: адаптивную сложность (IRT-lite), кеширование вопросов между сессиями (v2).

</domain>

<decisions>
## Implementation Decisions

### Формат вопросов
- Стиль: микс 70% практических кейсов + 30% теория/понятия/метрики
- 15 вопросов за сессию (по 3 на каждую из 5 категорий навыков)
- 4 варианта ответа на вопрос, 1 правильный
- Вопросы привязаны к SkillCategory через lesson_id маппинг

### Привязка к контенту
- Вопросы генерируются из chunks, допустимо комбинировать chunks из разных уроков одной категории
- Каждый вопрос привязан к SkillCategory, не обязательно к конкретному уроку

### Fallback поведение
- Спиннер ожидания "Готовим вопросы..." пока ждём LLM
- Цепочка моделей: Primary LLM -> Fallback LLM -> Mock вопросы
- Приоритет на надёжность — LLM не должен "падать" для пользователя

### Mock-вопросы (fallback база)
- 100 вопросов (по 20 на категорию) — AI-прегенерация через seed-скрипт
- Вопросы проверяются человеком перед включением в базу
- Текущая mock-база слишком мала — нужна полная замена

### Claude's Discretion
- Длина вариантов ответа (короткие vs развёрнутые)
- Показывать ли бейдж категории на вопросе во время теста
- Распределение вопросов по категориям (равномерное vs взвешенное)
- Стратегия генерации (пакетная vs по категории vs по одному)
- Уникальность вопросов между сессиями
- Кеширование сгенерированных вопросов
- Таймауты для каждого уровня fallback
- Стратегия обработки невалидных LLM-ответов (retry vs mock замена)

</decisions>

<specifics>
## Specific Ideas

- В будущем (другой фазой/майлстоуном) — гибкая система диагностики: выбор количества вопросов (10-100) и сложности для разных сегментов клиентов
- Mock-вопросы генерируются AI, затем human review, затем обновляем базу — pipeline "AI генерация -> ручная проверка -> продакшн"
- Превентивная система мониторинга здоровья LLM (health checks) — но это скорее Phase 5/6

</specifics>

<deferred>
## Deferred Ideas

- Гибкая диагностика (10-100 вопросов, выбор сложности) — отдельная фаза/майлстоун
- Адаптивная сложность IRT-lite — v2 requirement (DIAG-01)
- Кеширование вопросов для повторного использования — v2 requirement (DIAG-02)
- Health monitoring для LLM сервисов — Phase 5 (Security Hardening) или Phase 6 (Deploy)

</deferred>

---

*Phase: 02-ai-question-generation*
*Context gathered: 2026-02-17*
