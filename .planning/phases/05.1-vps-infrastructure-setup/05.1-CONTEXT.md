# Phase 05.1: VPS Infrastructure Setup - Context

**Gathered:** 2026-02-20
**Status:** Ready for planning

<domain>
## Phase Boundary

Подготовка VPS 89.208.106.208 для деплоя MAAL: настройка доступа, установка необходимого софта, firewall, временный домен с HTTPS. Сам деплой приложения — Phase 6.

</domain>

<decisions>
## Implementation Decisions

### Доступ и пользователи
- SSH key auth, пароль отключить (как на старом VPS)
- Credentials хранятся в `Server auth.md`
- На сервере уже есть другие сервисы (другой OpenClaw) — не ломать существующее
- Проверить что уже установлено перед установкой нового

### Софт и версии
- Node.js 20 LTS — проверить наличие, установить если нет (через nvm или NodeSource)
- Nginx — проверить наличие, установить если нет; добавить конфиг для MAAL
- Пользователь склоняется к Docker — рассмотреть Docker-подход для изоляции MAAL от существующих сервисов
- PM2 vs systemd vs Docker — на усмотрение Claude (Docker предпочтительнее)

### Сеть и безопасность
- UFW — проверить статус, настроить если нужно (порты 22, 80, 443, 3000)
- fail2ban — установить, но с whitelist для IP агентов (vps-ops-manager), чтобы не банить автоматику при множественных подключениях
- Дополнительные порты — на усмотрение Claude

### Временный домен
- **НЕ ngrok** — используем Cloudflare Tunnel или DuckDNS (бесплатное решение)
- Был Cloudflare аккаунт для Talent на старом VPS — можно переиспользовать
- Нужно простое и рабочее решение с HTTPS
- Конкретный выбор (Cloudflare Tunnel vs DuckDNS + Let's Encrypt) — на усмотрение Claude

### Claude's Discretion
- Выбор между отдельным пользователем `maal` или использованием существующего `deploy`
- PM2 vs systemd vs Docker compose для управления процессом
- Точный набор открытых портов (базовые + дополнительные)
- Выбор между Cloudflare Tunnel и DuckDNS для временного домена
- Docker architecture (Dockerfile, docker-compose)

</decisions>

<specifics>
## Specific Ideas

- На сервере уже работает другой OpenClaw — важно не нарушить его работу
- fail2ban должен быть настроен с учётом агентов (vps-ops-manager делает несколько подключений подряд — не банить)
- Ранее на старом VPS для Talent использовался Cloudflare free аккаунт — есть опыт и credentials
- ngrok free занят старым VPS (n8n) — поэтому Cloudflare/DuckDNS

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 05.1-vps-infrastructure-setup*
*Context gathered: 2026-02-20*
