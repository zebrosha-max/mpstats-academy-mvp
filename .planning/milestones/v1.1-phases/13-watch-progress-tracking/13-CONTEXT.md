# Phase 13: Watch Progress Tracking - Context

**Gathered:** 2026-02-27
**Status:** Ready for planning

<domain>
## Phase Boundary

Сохранение и отображение прогресса просмотра видео. Пользователь видит сколько посмотрел каждого урока, может продолжить с последней позиции, а на уровне курса видит общий процент завершения. Админ видит базовую статистику просмотров.

Требования: WATCH-01 (сохранение позиции + %), WATCH-02 (прогресс на карточках), WATCH-03 (возобновление с позиции), WATCH-04 (% завершения курса).

</domain>

<decisions>
## Implementation Decisions

### Сохранение прогресса
- Хранение в Supabase (БД), не localStorage — прогресс синхронизирован между устройствами и виден админу
- Порог "просмотрено": Claude's Discretion (ориентир ~90%)
- Минимальный порог записи: Claude's Discretion (ориентир ~5 сек)
- Debounce/интервал сохранения: Claude's Discretion
- Сохранять: позицию (секунды), процент просмотра, длительность видео, timestamp последнего обновления

### UI прогресса на карточках уроков
- Стиль индикатора на карточке урока: Claude's Discretion (прогресс-бар или круговой)
- Визуал завершённого урока: Claude's Discretion (галочка/зелёный акцент или приглушение)
- Прогресс курса на странице /learn: Claude's Discretion (прогресс-бар в шапке или текст)
- Dashboard: Claude's Discretion (может показывать сводку по курсам, может не трогать)

### Возобновление просмотра
- Поведение при возврате к уроку: Claude's Discretion (авто-seek + тост — рекомендуемый вариант)
- Кнопка "Начать сначала": Claude's Discretion
- Кнопка "Продолжить просмотр" на странице курса: Claude's Discretion (ведёт к последнему недосмотренному уроку)

### Расчёт прогресса курса
- Формула: Claude's Discretion (по кол-ву завершённых уроков или по среднему %)
- Уроки без видео (videoId=null): Claude's Discretion (пропускать или считать завершёнными)

### Админ-панель
- Базовая статистика просмотров в админ-панели: ДА (решение пользователя)
- Что показывать: средний % просмотра по курсам, топ-пользователи по активности, общая вовлечённость

### Claude's Discretion
- Все технические детали: debounce интервал, DB schema, postMessage API для Kinescope iframe
- Все UI-решения: стиль прогресс-бара, цвета, расположение, анимации
- Формула расчёта порога "просмотрено"
- Формула расчёта прогресса курса
- UX возобновления просмотра
- Конкретные метрики для админ-панели

</decisions>

<specifics>
## Specific Ideas

- Kinescope видео используют прямой iframe embed (`https://kinescope.io/embed/{videoId}`), не React-компонент — postMessage API для seekTo/play
- 405 видео загружены, все `Lesson.videoId` записаны в Supabase
- Админ-панель уже существует (Phase 10) — нужно добавить секцию статистики просмотров
- Lazy video loading уже реализован (Phase 12) — click-to-play placeholder

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 13-watch-progress-tracking*
*Context gathered: 2026-02-27*
