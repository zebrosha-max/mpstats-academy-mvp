# Requirements Archive: v1.0 MVP

**Archived:** 2026-02-26
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: MAAL Milestone 1

**Defined:** 2026-02-16
**Core Value:** Пользователь проходит AI-диагностику, получает точную карту навыков и персонализированный трек обучения из реальных данных.

## v1 Requirements

### Data Migration

- [x] **DATA-01**: Курсы и уроки загружаются из Supabase (таблицы Course/Lesson), а не из hardcoded mock
- [x] **DATA-02**: Seed script заполняет Course/Lesson таблицы из существующих content_chunk данных (6 курсов, 80+ уроков)
- [x] **DATA-03**: Маппинг lesson_id prefix → SkillCategory (01_analytics→ANALYTICS, 02_ads→MARKETING, etc.)
- [x] **DATA-04**: Learning router (`packages/api/src/routers/learning.ts`) использует Prisma вместо mock arrays
- [x] **DATA-05**: Diagnostic router (`packages/api/src/routers/diagnostic.ts`) сохраняет сессии в Supabase вместо globalThis Map
- [x] **DATA-06**: Profile router (`packages/api/src/routers/profile.ts`) читает реальные данные из DiagnosticSession/SkillProfile
- [x] **DATA-07**: Dashboard отображает реальную статистику (из migrated routers)
- [x] **DATA-08**: Mock fallback — если Supabase недоступна, приложение не крашится

### AI Question Generation

- [x] **AIGEN-01**: Сервис генерирует diagnostic вопросы из RAG chunks через LLM (4 варианта, 1 правильный)
- [x] **AIGEN-02**: Валидация структуры сгенерированных вопросов (Zod schema)
- [x] **AIGEN-03**: Fallback на mock вопросы если LLM недоступен или timeout (10s)
- [x] **AIGEN-04**: Вопросы привязаны к SkillCategory через lesson_id маппинг
- [x] **AIGEN-05**: Rate limiting для генерации вопросов (50 req/hour)

### Access Control

- [x] **ACCESS-01**: Пользователь без диагностики видит баннер "Пройди диагностику чтобы открыть видео"
- [x] **ACCESS-02**: Фильтр "Мой трек" показывает только рекомендованные уроки на основе SkillProfile
- [x] **ACCESS-03**: recommendedPath сохраняется в профиль пользователя (Supabase)
- [x] **ACCESS-04**: Badge "Рекомендовано для вас" на уроках из recommendedPath

### Video Integration

- [x] **VIDEO-01**: Kinescope API loader (`@kinescope/player-iframe-api-loader`) интегрирован
- [x] **VIDEO-02**: videoId маппинг — каждый урок имеет videoId из Kinescope
- [x] **VIDEO-03**: Timecode seek — клик по таймкоду в RAG chat перематывает видео
- [x] **VIDEO-04**: Fallback UI если videoId отсутствует (placeholder с сообщением)

### Security Hardening

- [x] **SEC-01**: AI router endpoints используют protectedProcedure (не publicProcedure)
- [x] **SEC-02**: Rate limiting на LLM endpoints (50 req/hour per user)
- [x] **SEC-03**: Санитизация AI output — замена dangerouslySetInnerHTML на безопасный рендеринг
- [x] **SEC-04**: Supabase service_role key доступен только server-side (не утекает в клиент)
- [x] **SEC-05**: Error boundaries в React компонентах (diagnostic, learning, chat)

### VPS Infrastructure

- [x] **INFRA-01**: SSH подключение к VPS работает через deploy пользователя
- [x] **INFRA-02**: Docker Engine + Compose, Nginx установлены и работают на VPS
- [x] **INFRA-03**: Firewall (UFW) настроен: порты 22, 80, 443 открыты; fail2ban защищает SSH
- [x] **INFRA-04**: HTTPS работает на academyal.duckdns.org через Nginx + Let's Encrypt

### Production Deploy

- [x] **DEPLOY-01**: Next.js standalone build (`output: 'standalone'` в next.config.js)
- [x] **DEPLOY-02**: Process management для production (Docker Compose `restart: unless-stopped` вместо PM2)
- [x] **DEPLOY-03**: Nginx reverse proxy с SSL (Let's Encrypt)
- [x] **DEPLOY-04**: Environment variables настроены на VPS
- [x] **DEPLOY-05**: Prisma binary targets для Linux (Ubuntu 24.04)
- [x] **DEPLOY-06**: Health check endpoint для мониторинга
- [x] **DEPLOY-07**: E2E верификация: ручная проверка 12/12 страниц в production (automated Playwright deferred to future)

### Lesson & Course Name Cleanup

- [x] **NAMING-01**: Ни одно название урока не содержит .mp4, .mov или других расширений файлов
- [x] **NAMING-02**: Названия модулей не содержат технических разделителей _ и нумерации вида "Модуль N_"
- [x] **NAMING-03**: Названия курсов не начинаются с технической нумерации ("1.", "2." и т.д.)
- [x] **NAMING-04**: Уроки внутри каждого модуля пронумерованы последовательно и логично
- [x] **NAMING-05**: Изменения применены в production и проверены визуально

## v2 Requirements

### Enhanced Diagnostics

- **DIAG-01**: Адаптивная сложность вопросов (IRT-lite) на основе предыдущих ответов
- **DIAG-02**: Кеширование сгенерированных вопросов для повторного использования
- **DIAG-03**: Визуализация прогресса навыков между диагностиками

### Content Management

- **CMS-01**: Административная панель для управления курсами/уроками
- **CMS-02**: Bulk import транскриптов и видео

### UX Polish

- **UX-01**: Dark mode toggle
- **UX-02**: Полное accessibility audit (WCAG 2.1 AA)
- **UX-03**: Полное QA покрытие (unit tests, component tests)
- **UX-04**: Watch progress tracking (процент просмотра видео)

## Out of Scope

| Feature | Reason |
|---------|--------|
| Mobile app | Web-first, мобильная версия не приоритет для MVP |
| Платёжная система | MVP бесплатный |
| Real-time уведомления | Не нужны для образовательного контента |
| SCORM/xAPI | Over-engineering для MVP |
| Gamification (бейджи, очки) | Усложняет без доказанной ценности |
| Custom video player | Kinescope предоставляет готовый |
| Multi-language | Только русский для MVP |
| Microservices | Monolith достаточен при текущей нагрузке |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| DATA-01 | Phase 1: Data Foundation | Complete |
| DATA-02 | Phase 1: Data Foundation | Complete |
| DATA-03 | Phase 1: Data Foundation | Complete |
| DATA-04 | Phase 1: Data Foundation | Complete |
| DATA-05 | Phase 1: Data Foundation | Complete |
| DATA-06 | Phase 1: Data Foundation | Complete |
| DATA-07 | Phase 1: Data Foundation | Complete |
| DATA-08 | Phase 1: Data Foundation | Complete |
| AIGEN-01 | Phase 2: AI Question Generation | Complete |
| AIGEN-02 | Phase 2: AI Question Generation | Complete |
| AIGEN-03 | Phase 2: AI Question Generation | Complete |
| AIGEN-04 | Phase 2: AI Question Generation | Complete |
| AIGEN-05 | Phase 2: AI Question Generation | Complete |
| VIDEO-01 | Phase 3: Video Integration | Complete |
| VIDEO-02 | Phase 3: Video Integration | Complete |
| VIDEO-03 | Phase 3: Video Integration | Complete |
| VIDEO-04 | Phase 3: Video Integration | Complete |
| ACCESS-01 | Phase 4: Access Control | Complete |
| ACCESS-02 | Phase 4: Access Control | Complete |
| ACCESS-03 | Phase 4: Access Control | Complete |
| ACCESS-04 | Phase 4: Access Control | Complete |
| SEC-01 | Phase 5: Security Hardening | Complete |
| SEC-02 | Phase 5: Security Hardening | Complete |
| SEC-03 | Phase 5: Security Hardening | Complete |
| SEC-04 | Phase 5: Security Hardening | Complete |
| SEC-05 | Phase 5: Security Hardening | Complete |
| INFRA-01 | Phase 5.1: VPS Infrastructure | Complete |
| INFRA-02 | Phase 5.1: VPS Infrastructure | Complete |
| INFRA-03 | Phase 5.1: VPS Infrastructure | Complete |
| INFRA-04 | Phase 5.1: VPS Infrastructure | Complete |
| DEPLOY-01 | Phase 6: Production Deploy | Complete |
| DEPLOY-02 | Phase 6: Production Deploy | Complete |
| DEPLOY-03 | Phase 6: Production Deploy | Complete |
| DEPLOY-04 | Phase 6: Production Deploy | Complete |
| DEPLOY-05 | Phase 6: Production Deploy | Complete |
| DEPLOY-06 | Phase 6: Production Deploy | Complete |
| DEPLOY-07 | Phase 6: Production Deploy | Complete |
| NAMING-01 | Phase 7: Name Cleanup | Complete |
| NAMING-02 | Phase 7: Name Cleanup | Complete |
| NAMING-03 | Phase 7: Name Cleanup | Complete |
| NAMING-04 | Phase 7: Name Cleanup | Complete |
| NAMING-05 | Phase 7: Name Cleanup | Complete |

**Coverage:**
- v1 requirements: 42 total
- Mapped to phases: 42
- Complete: 42
- Unmapped: 0

---
*Requirements defined: 2026-02-16*
*Last updated: 2026-02-16 after roadmap creation*
