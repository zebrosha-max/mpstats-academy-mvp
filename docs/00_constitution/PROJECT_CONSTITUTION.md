# Конституция проекта: MPSTATS Academy MVP

**Версия:** 1.0  
**Дата:** 2025-12-18  
**Статус:** Draft → Review

---

## 1. Миссия проекта

Создать MVP образовательной платформы с AI-диагностикой навыков и адаптивным обучением для селлеров маркетплейсов, используя существующий контент MPSTATS Academy.

---

## 2. Руководящие принципы

### 2.1 Принципы продукта

| Принцип | Описание | Антипаттерн |
|---------|----------|-------------|
| **MVP-first** | Минимум функций для валидации гипотезы. Каждая фича должна отвечать на вопрос "можем ли мы без этого запуститься?" | Добавление "nice-to-have" до валидации core-функций |
| **Data-informed** | Решения основаны на данных диагностики и поведения пользователя | Угадывание потребностей без метрик |
| **Content-as-Source-of-Truth** | Skill Graph и адаптация строятся из реального контента курсов, а не из внешних моделей | Абстрактные "идеальные профили" без привязки к материалам |

### 2.2 Принципы разработки

| Принцип | Описание |
|---------|----------|
| **Spec-before-code** | Код пишется только после утверждения спецификации |
| **Type-safety** | TypeScript strict mode, Prisma typed queries, tRPC |
| **Mobile-first responsive** | UI проектируется сначала для мобильных, затем масштабируется |
| **Incremental delivery** | Каждый спринт заканчивается deployable increment |

### 2.3 Принципы AI/RAG

| Принцип | Описание |
|---------|----------|
| **Grounded responses** | LLM отвечает ТОЛЬКО на основе контента из RAG, не галлюцинирует |
| **Cited sources** | Каждый ответ содержит ссылку на источник (урок, таймкод) |
| **Model-agnostic** | Архитектура позволяет переключать LLM-провайдеров без изменения кода |
| **Cost-aware** | Мониторинг расходов на inference, fallback на дешёвые модели |

---

## 3. Стандарты качества

### 3.1 Качество кода

```yaml
Linting:
  - ESLint: airbnb-typescript + custom rules
  - Prettier: single quotes, no semicolons, 2 spaces
  
TypeScript:
  - strict: true
  - noImplicitAny: true
  - strictNullChecks: true

Commits:
  - Conventional Commits (feat:, fix:, docs:, refactor:, test:)
  - Максимум 72 символа в заголовке
  
Pull Requests:
  - Обязательный code review
  - Связь с Task ID
  - Пройденные тесты
```

### 3.2 Качество UI/UX

| Метрика | Целевое значение |
|---------|------------------|
| Lighthouse Performance | ≥ 80 |
| Lighthouse Accessibility | ≥ 90 |
| First Contentful Paint | < 1.5s |
| Time to Interactive | < 3s |
| Breakpoints | 320px, 768px, 1024px, 1440px |

### 3.3 Качество AI/RAG

| Метрика | Целевое значение | Метод измерения |
|---------|------------------|-----------------|
| Relevance | ≥ 80% | Ручная оценка выборки (100 запросов) |
| Hallucination rate | < 5% | Проверка наличия источника в базе |
| Response time | < 3s (p95) | APM мониторинг |
| Citation accuracy | 100% | Автотест: ссылка ведёт на реальный контент |

---

## 4. Требования к тестированию

### 4.1 Уровни тестирования

```
┌─────────────────────────────────────┐
│         E2E Tests (Playwright)       │  ← Critical user flows
├─────────────────────────────────────┤
│       Integration Tests (Vitest)     │  ← API + DB + RAG
├─────────────────────────────────────┤
│         Unit Tests (Vitest)          │  ← Business logic
└─────────────────────────────────────┘
```

### 4.2 Coverage Requirements

| Тип | Минимальный coverage |
|-----|---------------------|
| Unit tests | 70% для бизнес-логики |
| Integration tests | Все API endpoints |
| E2E tests | Critical path: Auth → Diagnostic → Learning |

### 4.3 RAG-специфичное тестирование

| Тест | Описание |
|------|----------|
| Retrieval quality | Для набора эталонных вопросов проверяем, что top-5 chunks релевантны |
| Generation quality | Golden set из 50 вопросов с ожидаемыми ответами |
| Edge cases | Вопросы вне домена должны возвращать "не могу ответить" |

---

## 5. Архитектурные ограничения (Constraints)

### 5.1 Технологические

| Constraint | Значение | Причина |
|------------|----------|---------|
| Runtime | Node.js 20 LTS | Стабильность, поддержка |
| Database | PostgreSQL 15+ с pgvector | Векторный поиск без доп. сервисов |
| Monorepo | Да (Turborepo) | Единая кодовая база для MVP |
| Serverless | Next.js на Vercel / self-hosted | Простота деплоя |

### 5.2 Бизнесовые

| Constraint | Значение |
|------------|----------|
| Бюджет на LLM | Мониторинг, лимиты на пользователя |
| Контент | Только существующие курсы Academy |
| Биллинг | Не входит в MVP (отдельная фаза) |
| Интеграция с MPSTATS | Не входит в MVP |

---

## 6. Определения терминов (Glossary)

| Термин | Определение |
|--------|-------------|
| **Skill Graph** | Граф навыков, построенный из контента курсов. Узлы = навыки, рёбра = зависимости |
| **Diagnostic Session** | Сессия оценки знаний пользователя через интерактивные вопросы |
| **Skill Gap** | Разница между текущим уровнем навыка и целевым |
| **Adaptive Path** | Персонализированная последовательность уроков |
| **Chunk** | Фрагмент транскрипта (500-1000 токенов) с метаданными |
| **RAG** | Retrieval-Augmented Generation — поиск релевантных chunks + генерация ответа |
| **Learning Sprint** | Микро-урок длительностью 5-10 минут |

---

## 7. Роли и ответственности (RACI для субагентов)

| Область | Product | Backend | Frontend | Design | QA |
|---------|---------|---------|----------|--------|-----|
| PRD / User Stories | A | C | C | C | I |
| Technical Spec | C | A | C | I | C |
| Database Schema | I | A | I | - | C |
| API Design | C | A | C | - | C |
| RAG Pipeline | I | A | I | - | C |
| UI Components | C | I | A | R | C |
| Design System | I | - | C | A | I |
| Unit Tests | I | R | R | - | A |
| E2E Tests | C | C | C | - | A |
| Deployment | I | A | C | - | C |

**R** = Responsible, **A** = Accountable, **C** = Consulted, **I** = Informed

---

## 8. Definition of Done (DoD)

Задача считается выполненной когда:

- [ ] Код соответствует спецификации
- [ ] TypeScript компилируется без ошибок
- [ ] Lint проходит без warnings
- [ ] Unit тесты написаны и проходят
- [ ] Integration тесты (для API) написаны и проходят
- [ ] Code review пройден
- [ ] Документация обновлена (если применимо)
- [ ] UI соответствует дизайну и адаптивен
- [ ] Задача закрыта в трекере

---

## 9. Версионирование документа

| Версия | Дата | Автор | Изменения |
|--------|------|-------|-----------|
| 1.0 | 2025-12-18 | Claude (SDD Agent) | Initial draft |

---

**Следующий шаг:** Утверждение Конституции → Переход к PRD (Фаза 1)
